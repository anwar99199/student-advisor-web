# ๐ก๏ธ ุฏููู ุฅุนุฏุงุฏ ุฌุฏูู ุงููุฏูุฑูู
## Admins Table Setup Guide

---

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ุชู ููู ุจูุงูุงุช ุงููุฏูุฑูู ูู Frontend ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (Supabase) ูุชุญุณูู ุงูุฃูุงู ูุงูุงุญุชุฑุงููุฉ.

### ุงููุฒุงูุง:
- โ ูููุงุช ุงููุฑูุฑ **ูุดูุฑุฉ** ุจุงุณุชุฎุฏุงู bcrypt
- โ ุงูุชุญูู ูู ุงูุฌุงูุจ ุงูุฎุงุฏู (Server-side)
- โ ุฅููุงููุฉ ุฅุฏุงุฑุฉ ุงููุฏูุฑูู ุจุณูููุฉ
- โ ุชุชุจุน ุขุฎุฑ ุชุณุฌูู ุฏุฎูู
- โ ุฅููุงู/ุชูุนูู ุงููุฏูุฑูู
- โ ุฃุฏูุงุฑ ูุฎุชููุฉ (admin / super_admin)

---

## ๐๏ธ ุฌุฏูู ุงููุฏูุฑูู

### ุงูุฃุนูุฏุฉ:

| ุงูุนููุฏ | ุงูููุน | ุงููุตู |
|--------|-------|-------|
| `id` | UUID | ุงููุนุฑู ุงููุฑูุฏ |
| `email` | TEXT | ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (ูุฑูุฏ) |
| `password_hash` | TEXT | ูููุฉ ุงููุฑูุฑ ุงููุดูุฑุฉ (bcrypt) |
| `name` | TEXT | ุงุณู ุงููุฏูุฑ |
| `role` | TEXT | ุงูุฏูุฑ (admin / super_admin) |
| `is_active` | BOOLEAN | ูุดุท ุฃู ูุง |
| `created_at` | TIMESTAMPTZ | ุชุงุฑูุฎ ุงูุฅูุดุงุก |
| `updated_at` | TIMESTAMPTZ | ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ |
| `last_login_at` | TIMESTAMPTZ | ุขุฎุฑ ุชุณุฌูู ุฏุฎูู |

---

## ๐ ุฎุทูุงุช ุงูุชูุนูู

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก ุฌุฏูู ุงููุฏูุฑูู

1. ุงูุชุญ **Supabase Dashboard**
2. ุงุฐูุจ ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุงูุตู ูุญุชูู ููู `/CREATE_ADMINS_TABLE.sql`
4. ุงุถุบุท **Run**

### ุงูุฎุทูุฉ 2: ุฅุถุงูุฉ ุงููุฏูุฑูู ุงูุฃุณุงุณููู

ุงุณุชุฎุฏู ูุฐุง ุงูู API endpoint **ูุฑุฉ ูุงุญุฏุฉ ููุท** ูุฅุถุงูุฉ ุงููุฏูุฑูู:

```bash
curl -X POST https://ukxgekdhlyhaooqzdime.supabase.co/functions/v1/make-server-c2f27df0/admin/setup \
  -H "Content-Type: application/json" \
  -d '{
    "secret_key": "SETUP_ADMINS_2026"
  }'
```

**ุฃู** ุงุณุชุฎุฏู ุฃุฏุงุฉ HTTP Client ูุซู Postman/Insomnia:

```
POST /make-server-c2f27df0/admin/setup
Body: {
  "secret_key": "SETUP_ADMINS_2026"
}
```

### ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงููุฏูุฑูู

ุดุบูู ุงูุงุณุชุนูุงู ุงูุชุงูู:
```sql
SELECT id, email, name, role, is_active, created_at 
FROM admins;
```

ูุฌุจ ุฃู ุชุดุงูุฏ:
```
| email                          | name          | role        |
|--------------------------------|---------------|-------------|
| as8543245@gmail.com           | ุงููุฏูุฑ ุงูุฃูู  | super_admin |
| anwaralrawahi459@gmail.com    | ุงููุฏูุฑ ุงูุซุงูู | admin       |
```

### ุงูุฎุทูุฉ 4: ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู

1. ุงูุชุญ `/admin/login`
2. ุฌุฑูุจ ุชุณุฌูู ุงูุฏุฎูู ุจุฃุญุฏ ุงูุญุณุงุจูู:
   - `as8543245@gmail.com` / `A1999anw#`
   - `anwaralrawahi459@gmail.com` / `6101999`

---

## ๐ ุจูุงูุงุช ุงููุฏูุฑูู ุงูุฃุณุงุณููู

### ุงููุฏูุฑ ุงูุฃูู (Super Admin):
- **ุงูุจุฑูุฏ:** `as8543245@gmail.com`
- **ูููุฉ ุงููุฑูุฑ:** `A1999anw#`
- **ุงูุฏูุฑ:** `super_admin`

### ุงููุฏูุฑ ุงูุซุงูู (Admin):
- **ุงูุจุฑูุฏ:** `anwaralrawahi459@gmail.com`
- **ูููุฉ ุงููุฑูุฑ:** `6101999`
- **ุงูุฏูุฑ:** `admin`

---

## ๐ก API Endpoints

### 1. ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ
```
POST /make-server-c2f27df0/admin/login

Body:
{
  "email": "as8543245@gmail.com",
  "password": "A1999anw#"
}

Response:
{
  "success": true,
  "admin": {
    "id": "uuid",
    "email": "as8543245@gmail.com",
    "name": "ุงููุฏูุฑ ุงูุฃูู",
    "role": "super_admin"
  }
}
```

### 2. ุฅุนุฏุงุฏ ุงููุฏูุฑูู ุงูุฃููู (ูุฑุฉ ูุงุญุฏุฉ ููุท)
```
POST /make-server-c2f27df0/admin/setup

Body:
{
  "secret_key": "SETUP_ADMINS_2026"
}
```

### 3. ุนุฑุถ ุฌููุน ุงููุฏูุฑูู
```
GET /make-server-c2f27df0/admin/admins
```

### 4. ุฅูุดุงุก ูุฏูุฑ ุฌุฏูุฏ
```
POST /make-server-c2f27df0/admin/create-admin

Body:
{
  "email": "newadmin@example.com",
  "password": "SecurePassword123!",
  "name": "ูุฏูุฑ ุฌุฏูุฏ",
  "role": "admin"
}
```

### 5. ุชุญุฏูุซ ุญุงูุฉ ุงููุฏูุฑ
```
POST /make-server-c2f27df0/admin/update-admin

Body:
{
  "adminId": "uuid",
  "is_active": false,  // ุฃู true
  "role": "admin"      // ุฃู "super_admin"
}
```

---

## ๐ ุณูุฑ ุงูุนูู

### ุชุณุฌูู ุงูุฏุฎูู:
```
1. ุงููุฏูุฑ ูุฏุฎู ุงูุจุฑูุฏ ููููุฉ ุงููุฑูุฑ ูู /admin/login
   โ
2. Frontend ูุฑุณู ุงูุทูุจ ุฅูู /admin/login endpoint
   โ
3. Backend ูุชุญูู ูู:
   - ูุฌูุฏ ุงููุฏูุฑ ูู ุฌุฏูู admins
   - is_active = true
   - ูููุฉ ุงููุฑูุฑ ุตุญูุญุฉ (bcrypt.compare)
   โ
4. ูุชู ุชุญุฏูุซ last_login_at
   โ
5. ูุชู ุฅุฑุณุงู ุจูุงูุงุช ุงููุฏูุฑ (ุจุฏูู ูููุฉ ุงููุฑูุฑ)
   โ
6. Frontend ูุฎุฒู ุงูุจูุงูุงุช ูู localStorage
   โ
7. ุงููุฏูุฑ ููููู ุฅูู /admin/dashboard
```

---

## ๐ ุงูุฃูุงู

### ูุง ุชู ุชุทุจููู:
- โ **ูููุงุช ูุฑูุฑ ูุดูุฑุฉ** ุจุงุณุชุฎุฏุงู bcrypt
- โ **ูุง ูุชู ุฅุฑุฌุงุน ูููุงุช ุงููุฑูุฑ** ูู ุฃู response
- โ **Row Level Security** ููุนูู ุนูู ุฌุฏูู admins
- โ **ุงูุชุญูู ูู ุงููุดุงุท** (is_active) ูุจู ุงูุณูุงุญ ุจุงูุฏุฎูู
- โ **Secret Key** ููุฅุนุฏุงุฏ ุงูุฃููู ูููุน ุฅูุดุงุก ูุฏูุฑูู ุนุดูุงุฆููู
- โ **ุชุณุฌูู ุขุฎุฑ ุฏุฎูู** ููุฑุงูุจุฉ ุงููุดุงุท

### ุชูุตูุงุช ุฅุถุงููุฉ:
- ๐ ุบููุฑ `SETUP_ADMINS_2026` ูู ุงูููุฏ ุจุนุฏ ุงูุฅุนุฏุงุฏ ุงูุฃููู
- ๐ ุงุณุชุฎุฏู ูููุงุช ูุฑูุฑ ูููุฉ (8+ ุฃุญุฑูุ ุฃุฑูุงูุ ุฑููุฒ)
- ๐ ูู ุจูุฑุงุฌุนุฉ `last_login_at` ูููุฏูุฑูู ุจุงูุชุธุงู
- ๐ ุงุณุชุฎุฏู `is_active = false` ูุฅููุงู ูุฏูุฑ ูุคูุชุงู

---

## ๐๏ธ ุงุณุชุนูุงูุงุช SQL ูููุฏุฉ

### ุนุฑุถ ุฌููุน ุงููุฏูุฑูู ุงููุดุทูู:
```sql
SELECT id, email, name, role, last_login_at 
FROM admins 
WHERE is_active = true
ORDER BY last_login_at DESC NULLS LAST;
```

### ุชุบููุฑ ูููุฉ ูุฑูุฑ ูุฏูุฑ (ูู ุญุงูุฉ ุงููุณูุงู):
```sql
-- ุงุญุตู ุฃููุงู ุนูู hash ูู bcrypt
-- ุซู ูู ุจุงูุชุญุฏูุซ:
UPDATE admins 
SET password_hash = 'bcrypt_hash_here'
WHERE email = 'admin@example.com';
```

### ุนุฏุฏ ุงููุฏูุฑูู ุญุณุจ ุงูุฏูุฑ:
```sql
SELECT role, COUNT(*) as count 
FROM admins 
GROUP BY role;
```

### ุขุฎุฑ ุชุณุฌูู ุฏุฎูู ูููุฏูุฑูู:
```sql
SELECT email, name, last_login_at 
FROM admins 
WHERE last_login_at IS NOT NULL
ORDER BY last_login_at DESC;
```

---

## ๐จ ุชุฎุตูุตุงุช ููููุฉ

### 1. ุฅุถุงูุฉ ุฃุฏูุงุฑ ุฌุฏูุฏุฉ

ูู `/CREATE_ADMINS_TABLE.sql`:
```sql
role TEXT DEFAULT 'admin' CHECK (role IN ('admin', 'super_admin', 'moderator'))
```

### 2. ุฅุถุงูุฉ ุตูุงุญูุงุช

ูููู ุฅุถุงูุฉ ุนููุฏ `permissions` ูู ููุน JSONB:
```sql
ALTER TABLE admins ADD COLUMN permissions JSONB DEFAULT '{}'::jsonb;
```

ูุซุงู:
```json
{
  "can_delete_users": true,
  "can_approve_receipts": true,
  "can_create_subscriptions": true
}
```

### 3. ุชูุนูู ุงูุชุญูู ุจุฎุทูุชูู (2FA)

ุฅุถุงูุฉ ุฃุนูุฏุฉ:
```sql
ALTER TABLE admins ADD COLUMN two_factor_enabled BOOLEAN DEFAULT false;
ALTER TABLE admins ADD COLUMN two_factor_secret TEXT;
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. Secret Key ููุฅุนุฏุงุฏ
- `SETUP_ADMINS_2026` ูุฌุจ ุชุบููุฑู ูู ุงูููุฏ ุจุนุฏ ุงูุฅุนุฏุงุฏ ุงูุฃููู
- ุฃู ุงุญุฐู endpoint `/admin/setup` ุจุงููุงูู ุจุนุฏ ุงูุงุณุชุฎุฏุงู

### 2. ูููุงุช ุงููุฑูุฑ
- **ูุง ุชุฎุฒู ูููุงุช ุงููุฑูุฑ ุฃุจุฏุงู** ุจุดูู ูุตู
- ุงุณุชุฎุฏู bcrypt ุฏุงุฆูุงู
- ูู ุญุงูุฉ ุงููุณูุงูุ ูุฌุจ **ุฅุนุงุฏุฉ ุชุนููู** ูููุฉ ุงููุฑูุฑ ุนุจุฑ endpoint

### 3. ุงูุฌูุณุงุช (Sessions)
- ุญุงููุงู ูุชู ุงูุชุฎุฒูู ูู `localStorage`
- ูููู ุชุทููุฑ ูุธุงู JWT tokens ูููุฒูุฏ ูู ุงูุฃูุงู

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: "Admins already set up"
**ุงูุญู:** ุงูุฌุฏูู ูุญุชูู ุนูู ูุฏูุฑูู ุจุงููุนู. ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุงูุฅุนุฏุงุฏ.

### ูุดููุฉ: "ุจูุงูุงุช ุงูุฏุฎูู ุบูุฑ ุตุญูุญุฉ"
**ุงูุญู:**
1. ุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
2. ุชุญูู ูู ูููุฉ ุงููุฑูุฑ (ุญุณุงุณุฉ ูุญุงูุฉ ุงูุฃุญุฑู)
3. ุชุญูู ูู `is_active = true` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ูุดููุฉ: bcrypt error
**ุงูุญู:** ุชุฃูุฏ ูู ุฃู bcrypt ูุซุจุช ุจุดูู ุตุญูุญ ูู Deno environment

---

## โ Checklist

ูุจู ุงูุงุณุชุฎุฏุงู:

- [ ] ุชู ุฅูุดุงุก ุฌุฏูู `admins` ูู Supabase
- [ ] ุชู ุงุณุชุฏุนุงุก `/admin/setup` endpoint
- [ ] ุชู ุงูุชุญูู ูู ูุฌูุฏ ุงููุฏูุฑูู ูู ุงูุฌุฏูู
- [ ] ุชู ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ุจููุง ุงูุญุณุงุจูู
- [ ] ูููุงุช ุงููุฑูุฑ **ูุดูุฑุฉ** ูู ุงูุฌุฏูู (ุบูุฑ ููุฑูุกุฉ)
- [ ] `is_active = true` ูููุฏูุฑูู ุงููุดุทูู
- [ ] ุชู ุชุบููุฑ Secret Key ุฃู ุญุฐู endpoint setup

---

## ๐ ุงููุณุงุนุฏุฉ

ุฅุฐุง ูุงุฌูุช ูุดุงูู:
1. ุชุญูู ูู Supabase Edge Function Logs
2. ุชุญูู ูู Console ูู ุงููุชุตูุญ
3. ุฑุงุฌุน `/DATABASE_TABLES_SUMMARY.md`
4. ุชูุงุตู ุนูู: as8543245@gmail.com

---

**ุชู ุจูุฌุงุญ! ุงูุขู ูุฏูู ูุธุงู ูุฏูุฑูู ุขูู ูููุดูุฑ ๐**

ุขุฎุฑ ุชุญุฏูุซ: 17 ููุงูุฑ 2026
ุงูุฅุตุฏุงุฑ: 2.0.0
